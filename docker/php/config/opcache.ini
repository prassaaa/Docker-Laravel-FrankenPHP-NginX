; OPcache Configuration for Laravel with FrankenPHP
; This configuration is optimized for production use

; Enable OPcache
opcache.enable=1
opcache.enable_cli=1

; Memory Configuration
; Allocate 256MB for OPcache (adjust based on your needs)
opcache.memory_consumption=256

; Interned strings buffer size (MB)
opcache.interned_strings_buffer=16

; Maximum number of files that can be cached
opcache.max_accelerated_files=20000

; Cache validation frequency (0 = never check for updates)
; For production, set to 0. For development, use 2 (check every 2 seconds)
opcache.revalidate_freq=0

; Enable file timestamp validation
opcache.validate_timestamps=0

; Maximum file size that will be cached (0 = no limit)
opcache.max_file_size=0

; JIT Configuration (PHP 8+)
; JIT buffer size (100M)
opcache.jit_buffer_size=100M

; JIT mode: tracing JIT with profiling
; 1254 = tracing JIT, hot functions, profile on first request
opcache.jit=1254

; Save comments in opcache (required for annotations)
opcache.save_comments=1

; Fast shutdown
opcache.fast_shutdown=1

; File cache (second level cache)
; Useful for shared hosting or when memory is limited
;opcache.file_cache=/tmp/opcache

; Consistency checks (development only, disable in production)
opcache.consistency_checks=0

; Error log
opcache.error_log=/dev/stderr
opcache.log_verbosity_level=1

; Optimization level
opcache.optimization_level=0x7FFEBFFF

; Huge code pages (Linux only, requires OS support)
opcache.huge_code_pages=1

; Preload user (must match FrankenPHP user)
opcache.preload_user=appuser

; Preload script (for production only)
opcache.preload=/srv/docker/php/config/preload.php

; File update protection
; Prevents caching files that are less than 2 seconds old
opcache.file_update_protection=2

; Restrict API access to PHP scripts
opcache.restrict_api=/srv

; Maximum wasted memory percentage before restart
opcache.max_wasted_percentage=10

; OPcache blacklist file
; opcache.blacklist_filename=/srv/docker/php/config/opcache-blacklist.txt